<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PDF Split & Merge — Works Offline</title>
  <style>
    :root {
      --bg1: #6a11cb;
      --bg2: #2575fc;
      --accent1: #ff6a00;
      --accent2: #ee0979;
      --card: rgba(255,255,255,0.12);
      --muted: rgba(255,255,255,0.65);
    }

    * { box-sizing: border-box; }
    body {
      margin: 0; padding: 40px 16px; min-height: 100vh;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, 'Helvetica Neue', Arial, 'Noto Sans', 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';
      color: #fff;
      background: linear-gradient(135deg, var(--bg1), var(--bg2));
      display: grid; place-items: start center; gap: 24px;
    }

    h1 { margin: 0 0 8px; font-size: 28px; text-align: center; }
    p.lead { margin: 0 0 8px; text-align: center; color: var(--muted); }

    .wrap { width: 100%; max-width: 980px; }

    .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; }

    .card {
      background: var(--card);
      backdrop-filter: blur(10px);
      border-radius: 16px;
      padding: 20px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.25);
    }

    .card h2 { margin: 0 0 8px; font-size: 20px; }
    .hint { font-size: 13px; color: var(--muted); margin-bottom: 12px; }

    input[type="file"] {
      width: 100%;
      padding: 10px;
      border-radius: 12px;
      background: rgba(255,255,255,0.08);
      border: 1px dashed rgba(255,255,255,0.35);
      color: #fff;
    }

    .btn {
      appearance: none; border: 0; color: #fff; cursor: pointer;
      padding: 12px 16px; border-radius: 999px; font-weight: 600;
      background: linear-gradient(90deg, var(--accent1), var(--accent2));
      transition: transform .15s ease, box-shadow .15s ease, opacity .15s ease;
      width: 100%;
      margin-top: 12px;
    }
    .btn:hover { transform: translateY(-1px); box-shadow: 0 8px 18px rgba(0,0,0,0.3); }
    .btn:disabled { opacity: 0.5; cursor: not-allowed; }

    .row { display: grid; grid-template-columns: 1fr auto; gap: 10px; align-items: center; }

    .status {
      font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, 'Liberation Mono', monospace;
      background: rgba(0,0,0,0.25);
      border-radius: 12px; padding: 10px; margin-top: 10px; min-height: 40px;
      white-space: pre-wrap; color: #e7f5ff;
    }
    .small { font-size: 12px; color: var(--muted); }
  </style>
</head>
<body>
  <div class="wrap">
    <h1> PDF Splitter & Merger</h1>
    <p class="lead">Split a PDF into single-page PDFs (zipped) or merge multiple PDFs back together.</p>

    <div class="grid">
      <!-- Split -->
      <section class="card">
        <h2>📄 Split PDF into pages</h2>
        <p class="hint">Choose one PDF. Each page will become its own PDF inside a ZIP.</p>
        <input id="splitFile" type="file" accept="application/pdf" />
        <button id="splitBtn" class="btn" type="button" disabled>Split PDF</button>
        <div id="splitStatus" class="status" aria-live="polite"></div>
        <div class="small">Tip: Very large PDFs can take a moment. Keep the tab open.</div>
      </section>

      <!-- Merge -->
      <section class="card">
        <h2>🔗 Merge PDFs into one</h2>
        <p class="hint">Select multiple PDFs (hold Ctrl/⌘ to multi-select). They merge in filename order.</p>
        <input id="mergeFiles" type="file" accept="application/pdf" multiple />
        <button id="mergeBtn" class="btn" type="button" disabled>Merge PDFs</button>
        <div id="mergeStatus" class="status" aria-live="polite"></div>
        <div class="small">Tip: Rename files like page-1.pdf, page-2.pdf for correct order.</div>
      </section>
    </div>

    <p class="small" id="libStatus">Loading libraries…</p>
  </div>

  <!-- Libraries -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.17.1/pdf-lib.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>

  <!-- App -->
  <script>
    (function(){
      const byId = (id) => document.getElementById(id);
      const splitFile = byId('splitFile');
      const splitBtn = byId('splitBtn');
      const splitStatus = byId('splitStatus');
      const mergeFiles = byId('mergeFiles');
      const mergeBtn = byId('mergeBtn');
      const mergeStatus = byId('mergeStatus');
      const libStatus = byId('libStatus');

      const libsReady = () => !!(window.PDFLib && window.JSZip && window.saveAs);
      const setStatus = (el, msg) => { el.textContent = msg; };

      function enableUI(){
        splitBtn.disabled = false;
        mergeBtn.disabled = false;
        libStatus.textContent = 'Libraries loaded. Ready.';
      }

      function failUI(){
        splitBtn.disabled = true;
        mergeBtn.disabled = true;
        libStatus.textContent = 'Failed to load libraries. Please check your internet connection or try reloading the page.';
      }

      // Wait a tick so CDN scripts attach globals
      window.addEventListener('load', () => {
        if (libsReady()) enableUI(); else failUI();
      });

      // Guard: require a selected file before enabling button press
      splitFile.addEventListener('change', () => {
        splitBtn.disabled = !splitFile.files[0] || !libsReady();
      });
      mergeFiles.addEventListener('change', () => {
        mergeBtn.disabled = (mergeFiles.files.length === 0) || !libsReady();
      });

      // Split logic
      splitBtn.addEventListener('click', async () => {
        if (!libsReady()) return alert('Libraries not loaded yet.');
        const file = splitFile.files[0];
        if (!file) return alert('Please choose a PDF first.');

        try {
          setStatus(splitStatus, 'Reading PDF…');
          const buf = await file.arrayBuffer();
          const src = await PDFLib.PDFDocument.load(buf, { ignoreEncryption: false });
          const total = src.getPageCount();

          const zip = new JSZip();
          for (let i = 0; i < total; i++) {
            setStatus(splitStatus, `Creating page ${i+1} of ${total}…`);
            const out = await PDFLib.PDFDocument.create();
            const [page] = await out.copyPages(src, [i]);
            out.addPage(page);
            const bytes = await out.save();
            zip.file(`page-${String(i+1).padStart(3,'0')}.pdf`, bytes);
          }

          setStatus(splitStatus, 'Zipping files…');
          const blob = await zip.generateAsync({ type: 'blob' });
          saveAs(blob, `${file.name.replace(/\.pdf$/i,'')}-pages.zip`);
          setStatus(splitStatus, '✅ Done! Your ZIP download should start.');
        } catch (err) {
          console.error(err);
          const msg = /Encrypted/.test(String(err))
            ? 'This PDF appears to be password-protected. Remove the password first, then try again.'
            : 'Something went wrong while splitting. See console for details.';
          setStatus(splitStatus, '❌ ' + msg);
          alert(msg);
        }
      });

      // Merge logic
      mergeBtn.addEventListener('click', async () => {
        if (!libsReady()) return alert('Libraries not loaded yet.');
        const files = Array.from(mergeFiles.files || []);
        if (files.length < 2) return alert('Select at least two PDFs to merge.');

        // Sort in natural order by filename so page-2 comes before page-10
        files.sort((a,b) => a.name.localeCompare(b.name, undefined, { numeric: true, sensitivity: 'base' }));

        try {
          setStatus(mergeStatus, `Merging ${files.length} file(s)…`);
          const merged = await PDFLib.PDFDocument.create();

          for (let i = 0; i < files.length; i++) {
            const f = files[i];
            setStatus(mergeStatus, `Adding ${f.name} (${i+1}/${files.length})…`);
            const buf = await f.arrayBuffer();
            const pdf = await PDFLib.PDFDocument.load(buf, { ignoreEncryption: false });
            const pages = await merged.copyPages(pdf, pdf.getPageIndices());
            for (const p of pages) merged.addPage(p);
          }

          const out = await merged.save();
          const outName = files.length === 1 ? files[0].name.replace(/\.pdf$/i, '-merged.pdf') : 'merged.pdf';
          saveAs(new Blob([out], { type: 'application/pdf' }), outName);
          setStatus(mergeStatus, '✅ Done! Your merged PDF download should start.');
        } catch (err) {
          console.error(err);
          const msg = /Encrypted/.test(String(err))
            ? 'One of the PDFs appears to be password-protected. Remove the password first, then try again.'
            : 'Something went wrong while merging. See console for details.';
          setStatus(mergeStatus, '❌ ' + msg);
          alert(msg);
        }
      });
    })();
  </script>
</body>
</html>
